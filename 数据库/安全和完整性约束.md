## 数据安全
- 保证安全
  - 定义每个用户不同的视图。（用户视角）
  - 操作系统通过suid以及对数据库物理存储文件里的数据进行加密，防止别人不通过dbms直接访问数据库文件。
  - 通过对关系里的数据进行审计（相当于日志监控），只要有人进行了对这个数据的操作就将改操作的信息插入审计中。
- 访问控制
  - 一般用户
  - 拥有一定资源特权的用户
  - 数据库超级管理员DBA
    - 能够通过指令创建用户。
    - 对用户进行操作授权。
    - 通过角色进行授权。
- 统计安全：只允许某些用户查看关系的统计信息，不让他查看具体信息。
  - 但是这个会有很大的bug，用户可能可以利用系统给他的视图（select统计信息），进行多个统计信息的查找后，通过数学方法推算出某个个体的信息，而且理论上是肯定可行的。违背了DBA的初衷。

## 完整性约束
- 静态约束：一些基本的：例如一范式、外键、数据类型等约束。
  - 外键的级联删除问题。
  - 外键的级联插入、级联更新问题。
  - 数据范围约束
    - 直接通过应用程序判断，没有用到dbms
    - 通过dbms的`assert`来进行设置
    - 通过create表的时候设置`check`
        ![](/截图/截屏2020-03-2209.51.03.png)
  - 定义某个关系中的某个元组不让其他人用：
    - create表的时候通过`check` `constraint`来设置
        ![](/截图/截屏2020-03-2209.51.46.png)
  - 定义两个表元组和不大于某个数
    ![](/截图/截屏2020-03-2210.13.11.png)
    这种定义是错误的，因为这是在水手表定义的，而对船操作的时候不会执行这个限制条件。<br>需要定义一个断言
    ![](/截图/截屏2020-03-2210.15.37.png)
- 动态约束：状态转换的规则。
  - dbms在之前的介绍中都是被动的，用户通过sql让dbms执行，但是dbms需要有一些主动的功能，例如仓库中的货太少的时候，需要主动提醒进货。
  - 主动dbms由三个属性组成：E(事件)、C(检查)、A(执行动作)：监视事件，检查合不合规则，执行相应操作。
  - triggers(触发器)：用触发器绑定事件，当发生这个事件的时候，触发器被激活，检查是否符合条件，符合条件的话进行相应操作。
    ![](/截图/截屏2020-03-2210.31.31.png)
    当往水手表插入的水手年龄小于18的时候，将这条记录插到年轻水手表中。语句中`newsilors`是将插入的数据看成一张表。
  - ECA的执行方式
    - 立即执行：事务中的每一条语句都激活触发器。（大多数dbms的实现）
    - 延迟执行：等事务需要提交的时候再同一执行触发器。
    - 分离执行：ECA的sql作为派生事务运行，防止一个事务sql太多。
  - 连锁触发：一个触发器触发了另一个触发器，这样有可能出现触发的循环。为了防止这些现象，我们可以对连续触发限制它的数量。
  - ECA触发器的实现
    - 松耦合：与dbms独立开来，截获用户的sql然后进行触发器操作。
    - 紧耦合（大多数的dbms使用）：dbms内部实现触发器。
    - 嵌套耦合：对生成的语法树分析，将触发的操作的sql嫁接到原来的语法树中提交给dbms去执行。