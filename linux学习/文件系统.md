# linux磁盘管理要注意的点


## 1.linux在不修改数据的情况下将mbr转成gpt

###  通过gdisk工具。

*gdisk /dev/sda*
*按下w确认即可。*

*fdisk是用作mbr分区格式的操作*


## 2.linux下创建磁盘操作的步骤

*通过gdisk的相应指令操作*
*先输入n，创建相应的分区，然后再w，将相应的分区写入gpt分区表中即可实现更新，但是此时不会立刻进行更新，需要重启磁盘才会进行加载，我们也可以使用partprobe指令进行更新。*

*更新完后，需要在创建的磁盘中新建文件分区（格式化），此时使用mkfs.xfs /dev/sda4 实现某一个分区的格式化。其中通过-d来进行一些xfs文件系统的设置。*
*典型的设置一般有cpu核数的优化设置，基于raid磁盘阵列的参数设置等等。*

*紧接着就是将目录挂载到相应的分区上了，需要注意的是一个目录就对应一个文件系统，而且作为挂载点的目录得是空目录才行。*

*因为如果不是空目录，由于换了分区，原来分区中的数据就会被隐藏。等新分区被卸载了之后，这些被隐藏的数据又会冒出来，可以简单理解为新分区盖在了旧分区上面，当新分区被拿掉的时候，自然就用回了旧分区。*

想要删除分区也是借助gdisk命令。步骤和创建基本类似。

## 3.文件系统检验
#### 当文件系统有问题发生的时候，例如内存和硬盘之间的交互出了问题的时候，需要修复文件系统
*当进行文件的修复的时候，此时这个文件系统不能挂载在磁盘分区下，需要先进行卸载，操作完再安装回去。*

*当例如根目录这种已经挂载的目录需要重新挂载的时候，使用`mount -o remount,rw,auto /`来重新挂载。*

*也可以将一个目录（空目录）挂载到另一个目录下，mount --bind，就是将着两个目录硬连接到同一个inode。*

## 4.磁盘参数的自定义
*有时候想自己设置major（设备号）和minor（子分区号），使用mknod设置。*

*xfs_admin:管理xfs文件系统中的一些参数，例如labelname、uuid等。但是这些操作必须要在文件系统没有挂载等情况下进行。*

*tune2fs修改ext4文件系统的uuid和labelname，和上述功能一样。*

## 5.自动挂载
系统默认启动的时候会去/etc/fstab里面去读取相应的数据来初始化文件系统的挂载，所以我们如果想要设置的文件系统挂载在每次启动的时候生效的话就需要去重写这个文件，在这个文件后面添加一行你希望自动挂载的文件系统。
*（其中设备号那一部分最好填写uuid，因为同一个设备在不同系统中的硬盘划分可能会变，但是uuid是不会变的。）*

写完了以后通过mount -a自动根据/etc/fstab中的记录的数据去实施挂载。
如果在/etc/fstab中的数据出错了，那么开机的时候会进入单人维护模式，此时所有文件系统都会是只读的状态，此时需要执行：<br/>
`mount -n -o remount ,rw \`<br/>

## 6.镜像文件的挂载

#### 镜像文件和压缩文件的区别 
镜像文件是压缩文件的一种，只不过镜像文件里面包含了一些一般压缩文件没有的信息，例如引导程序、分区表等等。

#### 镜像文件的挂载方式
镜像文件可以不需要刻录(解压)也可以直接挂载使用，通过`mount -o loop xxx.iso /data/iso`来实现挂载。我们可以直接`cd /data/iso`来查看镜像中的目录。<br>

#### 在分区内再进行分区
###### 实现条件
那么此时我们便有了想法，如果系统此时没有空闲，不能再进行分区了，那么我们想让根目录下的某一个目录进行挂载新分区就不现实了，但是通过上述镜像文件的挂载方式，我们可以创建一个大文件，并将这个大文件格式化，将大文件挂载到那个目录中，也就相当于进行了一次分区。
###### 具体实现
1. 创建一个大文件，我们先创建一个1*512MB的文件：<br/>`dd if=/dev/zero of=/srv/loopdev bs=1M count=512`,其中`/dev/zero`是一个虚拟设备，可以无限提供0字符。
2. 接下来的想法就是强行将这个大文件写入一个文件系统（xfs），通过`mkfs.xfs -f /srv/loopdev`强行xfs格式化这个文件，此时已经能将这个文件看成一个分区了，使用之前挂载镜像文件的方法将一个目录挂载到这个文件下。`mount -o loop /src/loopdev /mnt`。<br />我们便实现了在不改变原有环境的基础上，在原分区中制作出你想要的分区，相当于将一个自制的文件变成了一个设备（分区）。
3. 将文件系统进行自动挂载。挂载的时候不能再/etc/fstab中写uuid，uuid只会加载设备分区，不会加载文件。

## 7.创建内存交换分区
####  新建分区创建内存交换分区
1. 创建的步骤和之前创建分区一模一样，只不过创建的系统名称为linux swap
2. 对创建的分区格式化，开始创建swap格式。`mkswap /dev/sda5`
3. 启动swap文件，`swapon /dev/sda5`
4. 使用过程通过`free`可以查看内存使用情况。
5. 写入 `/etc/fstab`。
#### 使用文件创建内存交换分区
步骤和上面的具体实现差不多，创建完文件之后用`mkswaap`进行格式化，用`swapon`将swap执行启动。
#### 内存交换分区的必要性
如果主机的性能够用的话，某种程度确实是不用内存交换分区的，但是有些应用场合，例如linux支持电源管理，那么当待机的时候可能会将内存中的内容存放到swap中，还是有必要的。

## 8. 对分区操作的通用方法
使用`parted`指令，可以支持mbr和gpt的操作。
相比于gdisk和fdisk的好处就是通用，还有就是在进行分区的操作的时候不用与用户进行交互，直接一条指令就可以完成操作。

## 9.第七章总结
用gdisk进行分区，mkfs进行分区的格式化，mount进行目录的挂载，自动挂载（/etc/fstab），mount -a更新。








