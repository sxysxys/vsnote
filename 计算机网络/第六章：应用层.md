## 简单理解
应用层协议基本可以等同于tcp/udp协议加一个端口，不同端口对应了不同的应用层协议。
## 虚拟机中的三种模式
首先明确一个概念：当我们查看计算机的网卡的时候，其中显示的网卡（如vm1、vm8等）都是主机用于和虚拟机通信的网卡，不是虚拟机的网卡。
1. 桥接模式：把虚拟机和主机独立了出来，需要对虚拟机设置ip地址以及各种配置；可供局域网内的其他主机做服务器用。<font color=red>此时虚拟机的ip地址必须和主机ip在同一个网段下才能通信。</font>相当于一台独立出来的主机，需要在该网段占用一个ip。
2. nat模式：一般用于网络的练习，一台主机上只能装一个nat模式的虚拟网络，在同一主机上的多个nat模式的虚拟机可以相互通信；当需要访问广域网的时候，会将虚拟机上的ip地址用主机的ip进行包裹，在外界看来，没有虚拟机这个东西（看不见虚拟机的ip），数据返回的时候，nat适配器根据特殊标记转发数据给相应的相应的虚拟机。<font color=red>主机通过vm8这个虚拟网卡和虚拟机通信，所以虚拟机必须要和vm8在同一个网段下。当主机和虚拟机与外界通信的时候通过主机真实ip出去，这时候主机的真实网卡相当于一个路由器。</font>
- 当自己使用虚拟机nat模式的时候，不知道为啥虚拟机ping不通主机真实网卡ip地址，后来发现vm8的网关必须和虚拟机的网关一样，因为实质上nat模式会将虚拟机和vm8的网关地址进行包裹，通过真实网卡ip发出去，所以nat模式的虚拟机想上网必须要配对网关，要不然包裹不了。
3. 主机模式：完全与外网隔绝，自己几个虚拟机玩。<font>主机通过vm1和虚拟机通信，虚拟机ip必须和vm1在一个网段。并且不能接网线连internet，因为接了网线主机便不会用vm1网卡了，此时主机ip和虚拟机不在一个网段下，便不能通信。</font>

### 总结
- 桥接模式其实就是在当前局域网下又加了一个主机。nat模式其实就是在当前主机中又开辟了一个局域网，其中vm8是主机在这个新开辟局域网下的地址，最这个局域网下的数据通过一个虚拟出来的网关一起发出去，包裹上真正的网卡ip，进行通信。
- 桥接模式一般用于虚拟机搭建服务器；而nat用于自己主机组成局域网。




## DNS服务
负责解析域名，将域名解析成ip地址。<br>
域名必须是全球唯一的<br>
什么是域名？
- 根：`.`
- 顶级域名：`com edu net cn org gov`
- 二级域名：`baidu`
例如`www.91xueit.com`，申请域名只是申请的`91xueit.com`，和前面的`www`没关系，可以在前面加其他的字符，如`mail.91xueit.com`都行。
- 还可以三级、四级等域名，就是在前面加.就行，就是访问起来太麻烦。
检查域名：
- 直接`ping 网址`看能不能解析出相应的ip地址
- `nslookup`查看给我们提供解析ip的dns服务器。

#### 域名注册
#### 域名解析的过程
- 过程
  ![](/截图/截屏2020-03-1420.24.01.png)
  每台电脑都配置了一台dns服务器，当访问网址的时候：
  1. 如果指向的dns服务器正好有相应的ip的话，就直接返回相应的ip
  2. 如果没有相应的网址，那么会求助和本dns服务器相连的根dns服务器，根服务器找到相应的dns服务器后，告知原dns服务器，然后这个dns就去求助相应的dns服务器，拿到相应ip后缓存到本地然后转发给用户。
- 为什么要建立自己的dns服务器：
  - 当访问学校的内网站的时候，将局域网中的计算机的dns指向内网的dns服务器，就能够直接访问内网，学校的网站便不需要进行dns服务器的注册；当学生的计算机想访问外网的时候，内网中的dns服务器可以找到广域网中的根dns服务器，使得学生可以正常访问internet。
  - 如果每个学生都用了广域网中的dns服务器，那么流量会很大；如果有内网的dns服务器，当一个学生查了一个广域网的网址对应的ip后，经过本地的dns服务器的时候会进行缓存，那么其他同学访问的时候就快了，减少了流量。
    ![](/截图/截屏2020-03-1420.16.43.png)

#### dns总结
如果只是内网访问的网址，就可以部署到内网的dns服务器中；但是需要外网也能访问这个网址的话，只有花钱将网址弄到广域网的dns服务器里。

## DHCP动态主机配置
- 静态ip地址
- 动态ip地址：DHCP服务器分配
#### DHCP请求动态地址的过程
局域网中存在dhcp服务器的话（局域网很多都是路由器），当计算机选择dhcp服务的时候，dhcp服务器就会给它们分配地址，其中有租约时间（需要定时续约）、dns服务器、网关、ip地址都需要在dhcp服务器上设置，然后服务器分配给接入的计算机。
- 要注意，当计算机接入的时候就会广播，如果局域网内有多个dhcp服务器，那么哪个dhcp服务器先响应就会用哪个dhcp服务器的地址。
- 当客户端（用户机）想离开该局域网时，可以直接走，等待dhcp租约到自动释放本ip，也可以使用命令释放本ip。
- dhcp服务器需要配置静态地址，保证在自己这个网段内。

#### 跨网段分配动态ip
![](/截图/截屏2020-03-1510.07.54.png)
当多个网段都需要进行dhcp服务时，不需要每一个网段都放一个dhcp服务器，只需要在一个网段中的dhcp服务器进行添加多个网段范围，此时有：
1. 本网段的主机发广播包请求dhcp服务，这时dhcp服务器需要查看这个广播包的网段是否在自己这个网段，如果在的话就直接在相应网段范围内取一个ip给他。
2. 如果是别的网段的请求dhcp服务，由于广播包是不能跨路由器的，所以需要在路由器的出口处配置一个`ip helper address dhcp服务器地址`命令，告诉这个路由dhcp服务器的ip是啥。这样每次转广播包的时候就会定向给到dhcp，dhcp再在相应网段取地址出来给回目标主机。

#### 和arp区别
- arp：已知ip地址，找寻mac地址，用于数据转发的时候。
- dhcp：已知mac地址，请求ip地址，用于ip配置的时候。

## 文件传输协议FTP
![](/截图/截屏2020-03-1510.31.15.png)
- 控制连接
  - 使用服务器的21端口，负责文件的操作命令。
- 其中数据连接分为两种模式：
  - 负责传输数据。
  - 主动模式：ftp客户端告诉ftp服务器使用什么端口侦听，ftp服务器就和ftp客户端的这个端口主动建立连接，源端口是20
  - 被动模式：与主动模式相反。服务器将打开的端口（随便一个）发送给客户端，被动的等待客户端传数据；如果有多个客户进行了ftp连接，那么服务器上就会开多个端口用来传输数据。
  - ftp服务器端如果有防火墙，我们需要在防火墙上开20和21端口，通信使用主动模式。主动模式收发数据只会开20端口。

## 远程终端协议TELNET
- 通过网络进行远程管理。可以管理主机也可以管理路由器。
- 由于路由器没有图形界面，可以通过这种方式进行路由器的设置。
- 通过TELNET远程管理主机，拿到远程主机相应的终端。
- `tednet ip 端口`：测试端口是否能访问，起到了端口扫描的功能。
- 要注意，telnet服务器必须要有密码；如果没有密码就不能使用TELNET客户端连，这是为了安全。

## RDP远程桌面协议
- 和telnet协议相比，一个是终端，一个是图形界面。
- 通过在RDP服务器中添加用户，在客户端连接的时候输入服务器中的用户名和密码即可，但是win中普通用户不能登录远程桌面，需要管理员组的成员或者远程桌面组的成员才能登录。
- 要注意，远程桌面是只支持单用户，一个用户只有在其他用户退出的时候才能登录系统。telnet却可以支持多个用户登录。
- 还可以把rdp客户端（本地）的磁盘资源映射到要连的rdp服务器的磁盘上，直接拖动就相当于把数据从一个客户端主机传到了服务器主机，非常方便。

## HTTP协议访问web服务器
- 服务器的80端口，常见的微软自带的服务器为iis，我们也可以用tomcat等服务器部署网站。
- 同一台服务器可以部署多个网站:
  - 一个ip不同端口：需要用端口区分，也就是将不同的网站部署到不同的端口上。
  - 多个ip：为该服务器再创建一个ip地址，将不同的网站部署到不同的ip地址上。
  - 同一个ip，同一个端口：如果要在同一个ip下，并且使用同一个端口，那么此时需要用域名来区分。在配置网站iis的时候使用不同的域名，并且在相应的dns服务器中配置好这些域名所指向的同一个ip，那么当访问这些不同的域名的时候虽然指向了同一个ip，但是iis服务器依然会根据不同的域名找到不同的网站。

## WEB代理访问网站
为什么要使用web代理服务器
1. 节省内网访问internet的带宽。当每台局域网的计算机都要访问某些特定的网站的时候，如果每次都从广域网走的话就会极大的占用带宽，这时候可以将计算机都指向一个web代理服务器，让这个web代理服务器帮计算机请求到了相应的网站后加入缓存，这样其他计算机如果访问同样的网址的话就不用再走internet了。
2. 可以使用代理服务器协助上网，如果一个网段内只有一台计算机开放了internet，那么可以在这台计算机上装一个web代理服务，让其他计算机都指向他这台计算机上，从而让其他的计算机都能上网。
3. 使用web代理服务器可以进行外网的访问
   ![](/截图/截屏2020-03-1517.55.36.png)
   路由器会截获一些目标ip（外网ip），我们通过代理服务器骗路由器（因为目标地址是代理服务器的地址），再通过代理服务器访问外网。<br>要注意，使用代理服务器访问外网可以，但是如果访问中国的网站也走外国代理服务器的话就会非常麻烦。
4. 使用外部代理来避免跟踪：有些服务器会请求客户端ip的地理位置，此时我们如果通过代理服务器访问这个服务器，那么服务器记录的就是代理服务器的地址。

-  只要代理服务器和你的计算机在一个网段，那么这台计算机就不用dns，也不用网关（只要代理服务器有就行了）也能上网。
-  代理服务器可以指定用户名和密码上网：想连接到这个代理服务器要输入相应的的用户名和密码。
-  也可以有控制哪些ip、哪些mac能上网的能力。

## 邮件服务
#### 发送邮件
![](/截图/截屏2020-03-1519.29.23.png)
发送邮件的过程：
1. 发送邮件客户端通过smtp协议将邮件发送到自己对应的邮件服务器的邮箱中。
2. 邮件服务器通过查dns找到真正收件人邮箱的ip，使用smtp将邮件给收件人的邮件服务器的邮箱中。
3. 收件人打开客户端，客户端会访问对应的邮件服务器，然后将收件箱通过pop3下载到本地中。

#### 实际操作
1. 安装pop3、smtp和dns服务。
2. 在dns服务器上，创建两个服务器邮箱对应的ip；创建邮件交换记录MX（将邮箱号和域名对应上）。
3. 在pop3服务上创建域名和邮箱。
4. 配置smtp服务器，运行*.com发送到远程（实现邮件的中继转发，只要带.com的域名就能转发）。
5. 配置outlookExpress（客户端），使用pop3收邮件。
   ![](/截图/截屏2020-03-1520.23.52.png)
这只是局域网下使用的模型。
<br>如果我们想在internet实现邮件收发，由于dns服务器可以访问internet上的dns，所以能够实现发送邮件；但想实现收邮件，由于internet的dns不知道本地的邮箱服务器的ip地址，所以我们需要将本地的邮件服务器域名和mx记录添加到internet上的dns服务器上去。

综上，smtp协议可以认为是把服务器中发送箱的邮件发出去的协议（可以是客户端到发送箱，或者服务器作中转站时将发送箱送到目标邮件服务器的收件箱）；而pop3可以认为是客户端把服务器的收件箱中的邮件收过来的协议。
















