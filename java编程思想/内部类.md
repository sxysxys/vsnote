# 内部类

## 链接到外部类
- 当生成一个内部类对象的时候，会先创建相应的的外部类，并将内部类连接到这个外部类上，生成相应的外部类引用；所以内部类中可以使用外部类的元组和方法等。
- 在内部类中使用`外部类名字.this`可以拿到当前外部类对象。

## 创建内部类对象
- 创建内部类对象之前必须有外部类的引用，要不然会编译报错。
- 可以使用匿名内部类创建内部类对象。
- 可以使用`外部类对象.new 内部类()`来创建。


## 为什么使用内部类？
- 通过内部类实现了接口，创建返回相应的引用。
- 解决复杂问题，创建一个类，外部不能直接访问，返回一个接口类型的，外部只能使用接口中的方法，不能向下转型。

## 匿名内部类
- 语法格式：`return new 接口/类(){.......}`，可以直接在接口或类后面写实现，非常方便，new的对象一般会被当做父类。
- 使用的较多，在匿名内部类中可以对外部类数据进行访问。
- 对返回匿名内部类的方法中传参数的时候，一般传入的是`final`类型的参数，因为当方法结束的时候，会清空堆栈，这时候传入的参数就消失了，这样拿到的匿名内部类某些字段会出现引用为空的情况，本质上就是对象和参数的生命周期不一样；如果是传入构造方法的形参中倒是不必加`final`。
- 使用匿名内部类改造工厂方法。


## 嵌套类
- 将内部类前面加上`static`称为嵌套类，嵌套类相当于隔断了内部类和外部类之间的联系。不能在嵌套类中访问外部类中非`static`元素，包括new外部类中的普通内部类。
- 非`static`的普通内部类中不能有static元素，因为使用内部类之前必须要有外部类对象，所以内部类如果有static也没什么意义。
- 接口内部的类默认为static。

#### 理解
- 可以将内部类和内部静态类理解为类中的普通元组和静态元组。当new一个内部类的时候相当于直接访问了普通元组。

#### 静态内部类的加载
[静态内部类的加载顺序](https://www.cnblogs.com/maohuidong/p/7843807.html)

## 内部类的继承
- 由于创建对象的时候需要先执行其父类的构造方法，所以内部类的继承需要拿到对内部类的外部类的引用。通过特殊的语法将外部类对象传入并初始化：
  ```java
  class I1{
      class I2{}
  }
  public class I3 entends I1.I2{
    I3(I1 i1){
        i1.super();
    }
  }
  ```
其实继承的类是不具备外部类的引用的，就是当执行super的方法的时候需要外部类的引用。

#### 内部类的覆盖
看书

## 局部内部类
- 在方法中定义内部类。
  - 注意传参加final。
  - 注意必须实现一个接口，要不然返出去的引用别人不认识。
- 直接返回匿名内部类。

#### 注意
都能够访问外部类的元组。所以它们都具有外部类的引用。


